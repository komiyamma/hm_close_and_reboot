# HmWmClose - 秀丸エディタ強制終了＆再起動ツール

## 概要

このツールは、Windows上で動作するテキストエディタ「秀丸エディタ」を、常駐プロセスも含めて安全かつ強制的に終了させるためのコマンドラインアプリケーションです。

秀丸エディタを終了させた直後に再度起動しようとすると、共有メモリ関連のエラーが発生することがあります。このツールは、その問題を回避し、確実な再起動を可能にすることを目的としています。

## 背景（解決する問題）

通常、アプリケーションを強制終了させるには `taskkill` コマンドなどが使われます。しかし、秀丸エディタの場合、単純にプロセスを強制終了（kill）するだけでは、内部状態が正しく保存されずに終了してしまいます。

その結果、直後に秀丸エディタを再起動しようとすると、ロックされた共有メモリへのアクセスでエラーが発生し、正常に起動できなくなることがあります。このツールは、そうした問題を未然に防ぐために、より丁寧な手順で終了処理を行います。

## 動作の仕組み

本ツールは、以下の手順で秀丸エディタを安全に終了させます。

1.  **プロセスの特定**: `hidemaru` というプロセス名を持つすべてのプロセスを探します。
2.  **ウィンドウハンドルの一覧取得**: 見つかったプロセスに属するすべてのウィンドウハンドル（ウィンドウを識別するためのID）を取得します。
3.  **正常終了リクエスト (WM_CLOSE)**: 取得したすべてのウィンドウに対して、Windowsの標準的な終了メッセージである `WM_CLOSE` を送信します。これは、ユーザーがウィンドウの「閉じる」ボタンを押したときと同じ動作であり、アプリケーションに正常な終了処理を促します。
4.  **終了待機**: `WM_CLOSE` 送信後、プロセスが自然に終了するのを最大2秒間待ちます。
5.  **最終的な強制終了**: 待機時間が経過してもまだプロセスが残存している場合、それらを強制的に終了（kill）します。これにより、応答しないプロセスも確実に終了させます。

この多段階の終了処理により、秀丸エディタは自身の状態をクリーンアップする機会を得られ、共有メモリの問題を発生させることなく安全に終了できます。

## 使い方

1.  リリースページから `HmWmClose.exe` をダウンロードします。
2.  コマンドプロンプトやPowerShell、またはバッチファイルから `HmWmClose.exe` を実行します。

```shell
.\HmWmClose.exe
```

実行すると、実行中の秀丸エディタがすべて終了します。

## ビルド方法

このプロジェクトは C# で書かれています。Visual Studio で `src/HmWmClose.csproj` ファイルを開き、ビルドすることで実行ファイルを生成できます。
.NET Framework が必要です。
